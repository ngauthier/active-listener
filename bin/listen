#!/usr/bin/env ruby
require 'active_listener'

running = true
Signal.trap("TERM") do
  running = false
end

if ARGV[0].nil? or ARGV[1].nil? or ARGV[2].nil?
  puts "USAGE: listen <config_file> <log_file> <rake_root>"
  exit(1)
end

@al = ActiveListener.new :config => ARGV[0], :log_file => ARGV[1], :rake_root => ARGV[2]

if @al.events.empty?
  log = File.new(ARGV[1], 'a')
  log.write "ActiveListener is very boring without events"
  log.close
  running = false
end

while running
  @al.fire_events
  @al.sleep_to_next_event
end
